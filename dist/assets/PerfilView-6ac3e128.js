import{_ as x,u as U,i as d,j as y,q as A,r as N,o as v,c as f,a,m as S,w as z,b as W,t as i,k as j,l as _,v as b,n as h,e as C,x as w,g as M}from"./index-aef3be03.js";const T={class:"profile-container"},B={class:"header"},F={class:"header-actions"},I={key:0,class:"loading"},R={key:1,class:"profile-content"},L={class:"card"},q={class:"profile-info"},O={class:"info-item"},$={class:"info-item"},G={class:"info-item"},H={class:"card"},J={class:"form-group"},K={class:"form-group"},Q={class:"form-group"},X={key:0,class:"error-message"},Y=["disabled"],Z={class:"stats-card card"},ss={class:"stats-grid"},as={class:"stat-item"},ts={class:"stat-number"},es={class:"stat-item"},os={class:"stat-number"},rs={class:"stat-item"},is={class:"stat-number"},ns={__name:"PerfilView",setup(ls){const D=U(),p=d({}),l=d({totalContacts:0,contactsWithEmail:0,contactsWithAddress:0}),g=d(!0),u=d(!1),n=d(""),c=d(""),t=y({nombre_de_usuario:"",password:"",confirmPassword:""}),m=y({confirmPassword:""}),P=async()=>{try{const e=await w.get("/usuario/perfil.php");e.data.success&&(p.value=e.data.data);const s=await w.get("/contactos/");if(s.data.success){const r=s.data.data;l.value.totalContacts=r.length,l.value.contactsWithEmail=r.filter(o=>o.email).length,l.value.contactsWithAddress=r.filter(o=>o.direccion).length}}catch(e){console.error("Error cargando datos del perfil:",e)}finally{g.value=!1}},E=()=>{let e=!0;return m.confirmPassword="",t.password&&t.password!==t.confirmPassword&&(m.confirmPassword="Las contraseñas no coinciden",e=!1),e},V=async()=>{var e,s;if(E()){u.value=!0,n.value="";try{const r={};if(t.nombre_de_usuario.trim()&&(r.nombre_de_usuario=t.nombre_de_usuario),t.password&&(r.password=t.password),Object.keys(r).length===0){n.value="No hay cambios para actualizar",c.value="info",u.value=!1;return}const o=await w.put("/usuario/editar.php",r);o.data.success?(n.value="¡Perfil actualizado exitosamente!",c.value="success",t.nombre_de_usuario="",t.password="",t.confirmPassword="",await P()):(n.value=o.data.message||"Error al actualizar perfil",c.value="error")}catch(r){n.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||"Error de conexión",c.value="error"}finally{u.value=!1}}},k=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return A(()=>{P()}),(e,s)=>{const r=N("router-link");return v(),f("div",T,[a("div",B,[s[5]||(s[5]=a("h1",null,"Mi Perfil",-1)),a("div",F,[S(r,{to:"/agenda",class:"btn btn-secondary"},{default:z(()=>[...s[4]||(s[4]=[M(" Volver a Agenda ",-1)])]),_:1}),a("button",{onClick:s[0]||(s[0]=o=>W(D).logout()),class:"btn btn-delete"}," Cerrar Sesión ")])]),g.value?(v(),f("div",I,"Cargando información del perfil...")):(v(),f("div",R,[a("div",L,[s[10]||(s[10]=a("h3",null,"Información del Perfil",-1)),a("div",q,[a("div",O,[s[6]||(s[6]=a("label",null,"Usuario:",-1)),a("span",null,i(p.value.nombre_de_usuario),1)]),a("div",$,[s[7]||(s[7]=a("label",null,"ID de Usuario:",-1)),a("span",null,i(p.value.id),1)]),a("div",G,[s[8]||(s[8]=a("label",null,"Fecha de Registro:",-1)),a("span",null,i(k(p.value.fecha_registro)),1)]),s[9]||(s[9]=a("div",{class:"info-item"},[a("label",null,"Estado:"),a("span",{class:"status active"},"Activo")],-1))])]),a("div",H,[s[14]||(s[14]=a("h3",null,"Editar Perfil",-1)),a("form",{onSubmit:j(V,["prevent"])},[a("div",J,[s[11]||(s[11]=a("label",{for:"nuevoUsuario"},"Nuevo Usuario:",-1)),_(a("input",{type:"text",id:"nuevoUsuario","onUpdate:modelValue":s[1]||(s[1]=o=>t.nombre_de_usuario=o),placeholder:"Dejar vacío para no cambiar"},null,512),[[b,t.nombre_de_usuario]])]),a("div",K,[s[12]||(s[12]=a("label",{for:"nuevaPassword"},"Nueva Contraseña:",-1)),_(a("input",{type:"password",id:"nuevaPassword","onUpdate:modelValue":s[2]||(s[2]=o=>t.password=o),placeholder:"Dejar vacío para no cambiar"},null,512),[[b,t.password]])]),a("div",Q,[s[13]||(s[13]=a("label",{for:"confirmarPassword"},"Confirmar Contraseña:",-1)),_(a("input",{type:"password",id:"confirmarPassword","onUpdate:modelValue":s[3]||(s[3]=o=>t.confirmPassword=o),placeholder:"Confirmar nueva contraseña",class:h({"input-error":m.confirmPassword})},null,2),[[b,t.confirmPassword]]),m.confirmPassword?(v(),f("span",X,i(m.confirmPassword),1)):C("",!0)]),a("button",{type:"submit",class:"btn btn-primary",disabled:u.value},i(u.value?"Actualizando...":"Actualizar Perfil"),9,Y)],32),n.value?(v(),f("div",{key:0,class:h(["message",c.value])},i(n.value),3)):C("",!0)]),a("div",Z,[s[18]||(s[18]=a("h3",null,"Estadísticas",-1)),a("div",ss,[a("div",as,[a("div",ts,i(l.value.totalContacts),1),s[15]||(s[15]=a("div",{class:"stat-label"},"Contactos Totales",-1))]),a("div",es,[a("div",os,i(l.value.contactsWithEmail),1),s[16]||(s[16]=a("div",{class:"stat-label"},"Con Email",-1))]),a("div",rs,[a("div",is,i(l.value.contactsWithAddress),1),s[17]||(s[17]=a("div",{class:"stat-label"},"Con Dirección",-1))])])])]))])}}},us=x(ns,[["__scopeId","data-v-08ad0344"]]);export{us as default};
